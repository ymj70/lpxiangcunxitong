<div class="framePage">
    <div class="framePage-title">
        <a href="javascript:;">人员登记</a>
        <i>></i>
        <a href="javascript:;" class="cur-a">城乡居民养老保险参保登记</a>
    </div>
    <div class="framePage-body layui-form">
        <div class="framePage-scroll">
            <div class="ovy-a">
                <div class="bg-box">
                    <div class="care">
                        <div class="h3-title">
                            <h3>读取身份证信息</h3>
                        </div>
                        <div class="pbox">
                            <p>1.请将用户身份证按下图样式放在身份证读卡器上，点击【读取】按钮读取用户身份证信息，或者手动填写用户身份证号码。</p>
                            <p>2.读取身份证信息过程中请勿将身份证取出。</p>
                        </div>
                    </div>
                    <div class="demo">
                        <div class="demo-page">
                            <div class="demo-pagepd">

                                <div class="img-box2">
                                    <img src="__PUBLIC__/image/dk.png" alt="">
                                </div>
                            </div>

                        </div>
                        <div class="demo-page">
                            <div class="demo-pagepd">
                                <div class="user-information information-search">
                                    <div class="information-box">
                                        <div>
                                            <div>
                                                <label for="">身份证号</label>
                                            </div>
                                            <div>
                                                <input type="text" class="layui-input" id="name">
                                                <button class="bgc-blued layui-btn" onclick="getData()">
                                                    <i class="layui-icon layui-icon-search"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <div>
                                            <div>
                                                <label for="">姓&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;名</label>
                                            </div>
                                            <div>
                                                <span><input type="text" id="realName" class="layui-input"</span>
                                            </div>
                                        </div>
                                        <div>
                                            <div>
                                                <label for="">身份证号</label>
                                            </div>
                                            <div>
                                                <span><input type="text" id="idCard" class="layui-input"></span>
                                            </div>
                                        </div>
                                        <div>
                                            <div>
                                                <label for="">户籍地址</label>
                                            </div>
                                            <div>
                                                <span><input type="text" id="idCardAddress" class="layui-input"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="btn-box layui-form">
            <button class="layui-btn bgc-green b-pd" onclick="getidCard()">读卡</button>
            <button class="layui-btn bgc-blued  b-pd" onclick="nextSteup()">下一步</button>
        </div>
    </div>
</div>
</div>
</body>
<include file="Public:footer"/>
</html>

<script>
    var idCardStatus = true;

    function getidCard() {
        if (!idCardStatus) {
            layer.msg("身份证正在读取中请稍后在试");
            return
        }
        idCardStatus = false;
        $("#realName").attr("value", "")
        $("#idCard").attr("value", "")
        try {
            jsidcard.getIdCard(function (IdNumber, Name) {
                if (IdNumber && Name) {
                    $("#realName").attr("value", Name)
                    $("#idCard").attr("value", IdNumber)
                    getPeopleInfoByIdcard(IdNumber);
                    idCardStatus = true;
                } else {
                    layer.msg("未读取到身份证信息")
                }
            });
        } catch (err) {
            layer.msg("读取身份证信息失败")
        }
    }

    function nextSteup() {
        if (check() == false) {
            return;
        }
        $.ajax({
            type: "post",
            url: "{:U('/Home/EndowmentInsAttend/checkEndowmentInsAttendStatus')}",
            data: {
                idCard: $("#idCard").val(),//身份证号
                realName: $("#realName").val(), //姓名
            },
            dataType: "json",
            beforeSend: function () {
            },
            success: function (ret) {
                if (ret.code == 1) {
                    if (ret.url == "") {
                        layer.msg("跳转路径接受失败");
                    } else {
                        window.location.href = ret.url;
                    }
                    $("#listHtml").html(ret.data)
                } else {
                    if (ret.message == '') {
                        layer.msg('请求失败');
                    } else {
                        layer.msg(ret.message);

                    }
                }
            },
        });

    }

    //校验
    function check() {
        if ($("#idCard").val() == "") {
            layer.msg("输入身份证号");
            return false;
        };
        if ($("#realName").val() == "") {
            layer.msg("输入身份证号");
            return false;
        };
    }

</script>